@model ArchiveDomain.Model.Query

@{
    ViewData["Title"] = "Результати запиту";
}

<section class="sessions-section py-4 gray-bg">
    <div class="container-fluid">
        <h1 class="section-title text-center mb-5">Результати запиту @Model.QueryName</h1>

        @if (Model.ErrorFlag == 1)
        {
            <div class="alert alert-danger shadow-sm">
                @Model.ErrorName
            </div>
        }
        else
        {
            <div class="card shadow-sm rounded @(Model.QueryName == "Q6" || Model.QueryName == "Q7" || Model.QueryName == "Q8" ? "highlight-card" : "")">
                <div class="card-body">
                    @switch (Model.QueryName)
                    {
                        case "Q1":
                            <h3 class="card-title">Вірші автора з прізвищем <b>@Model.LastName</b>, у назві яких є <b>@Model.Keyword</b>, з >= @Model.MinLikes лайків</h3>
                            <table class="table table-bordered table-hover">
                                <thead class="table-header bg-maroon text-white">
                                    <tr>
                                        <th>ID</th>
                                        <th>Назва</th>
                                        <th>Текст</th>
                                        <th>Дата публікації</th>
                                        <th>Автор</th>
                                        <th>Мова</th>
                                        <th>Адміністратор</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (!Model.Poems.Any())
                                    {
                                        <tr><td colspan="7" class="text-muted text-center">Результатів не знайдено</td></tr>
                                    }
                                    else
                                    {
                                        foreach (var poem in Model.Poems)
                                        {
                                            <tr>
                                                <td>@poem.Id</td>
                                                <td>@poem.Title</td>
                                                <td>@poem.Text</td>
                                                <td>@poem.PublicationDate.ToString("dd.MM.yyyy")</td>
                                                <td>@poem.AuthorName</td>
                                                <td>@poem.LanguageName</td>
                                                <td>@poem.AdminName</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                            break;

                        case "Q2":
                            <h3 class="card-title">Автори, які писали мовою <b>@Model.LanguageName</b></h3>
                            <table class="table table-bordered table-hover">
                                <thead class="table-header bg-maroon text-white">
                                    <tr>
                                        <th>ID</th>
                                        <th>Повне ім'я</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (!Model.Authors.Any())
                                    {
                                        <tr><td colspan="2" class="text-muted text-center">Результатів не знайдено</td></tr>
                                    }
                                    else
                                    {
                                        foreach (var author in Model.Authors)
                                        {
                                            <tr>
                                                <td>@author.Id</td>
                                                <td>@author.FullName</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                            break;

                        case "Q3":
                            <h3 class="card-title">Жанри віршів, опублікованих після <b>@Model.AfterDate.Value.ToString("dd.MM.yyyy")</b></h3>
                            <table class="table table-bordered table-hover">
                                <thead class="table-header bg-maroon text-white">
                                    <tr>
                                        <th>Жанр</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (!Model.Genres.Any())
                                    {
                                        <tr><td colspan="1" class="text-muted text-center">Результатів не знайдено</td></tr>
                                    }
                                    else
                                    {
                                        foreach (var genre in Model.Genres)
                                        {
                                            <tr>
                                                <td>@genre</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                            break;

                        case "Q4":
                            <h3 class="card-title">Користувачі, які лайкали жанр <b>@Model.FormName</b></h3>
                            <table class="table table-bordered table-hover">
                                <thead class="table-header bg-maroon text-white">
                                    <tr>
                                        <th>ID</th>
                                        <th>Ім'я користувача</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (!Model.Users.Any())
                                    {
                                        <tr><td colspan="2" class="text-muted text-center">Результатів не знайдено</td></tr>
                                    }
                                    else
                                    {
                                        foreach (var user in Model.Users)
                                        {
                                            <tr>
                                                <td>@user.Id</td>
                                                <td>@user.UserName</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                            break;

                        case "Q5":
                            <h3 class="card-title">Вірші адміна <b>@Model.AdminName</b> мовою <b>@Model.LanguageName</b></h3>
                            <table class="table table-bordered table-hover">
                                <thead class="table-header bg-maroon text-white">
                                    <tr>
                                        <th>ID</th>
                                        <th>Назва</th>
                                        <th>Текст</th>
                                        <th>Дата публікації</th>
                                        <th>Автор</th>
                                        <th>Мова</th>
                                        <th>Адміністратор</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (!Model.Poems.Any())
                                    {
                                        <tr><td colspan="7" class="text-muted text-center">Результатів не знайдено</td></tr>
                                    }
                                    else
                                    {
                                        foreach (var poem in Model.Poems)
                                        {
                                            <tr>
                                                <td>@poem.Id</td>
                                                <td>@poem.Title</td>
                                                <td>@poem.Text</td>
                                                <td>@poem.PublicationDate.ToString("dd.MM.yyyy")</td>
                                                <td>@poem.AuthorName</td>
                                                <td>@poem.LanguageName</td>
                                                <td>@poem.AdminName</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                            break;

                        case "Q6":
                            <h3 class="card-title">Користувачі з такими ж лайками, як користувач <b>@Model.UserId</b></h3>
                            <table class="table table-bordered table-hover">
                                <thead class="table-header bg-blue text-white">
                                    <tr>
                                        <th>ID</th>
                                        <th>Ім'я користувача</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (!Model.Users.Any())
                                    {
                                        <tr><td colspan="2" class="text-muted text-center">Результатів не знайдено</td></tr>
                                    }
                                    else
                                    {
                                        foreach (var user in Model.Users)
                                        {
                                            <tr>
                                                <td>@user.Id</td>
                                                <td>@user.UserName</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                            break;

                        case "Q7":
                            <h3 class="card-title">Пари користувачів з однаковими лайками</h3>
                            <table class="table table-bordered table-hover">
                                <thead class="table-header bg-blue text-white">
                                    <tr>
                                        <th>Користувач A</th>
                                        <th>Користувач B</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (!Model.UserPairs.Any())
                                    {
                                        <tr><td colspan="2" class="text-muted text-center">Результатів не знайдено</td></tr>
                                    }
                                    else
                                    {
                                        foreach (var pair in Model.UserPairs)
                                        {
                                            <tr>
                                                <td>@pair.UserA</td>
                                                <td>@pair.UserB</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                            break;

                        case "Q8":
                            <h3 class="card-title">Користувачі, які лайкнули всі вірші автора <b>@Model.AuthorId</b></h3>
                            <table class="table table-bordered table-hover">
                                <thead class="table-header bg-blue text-white">
                                    <tr>
                                        <th>ID</th>
                                        <th>Ім'я користувача</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (!Model.Users.Any())
                                    {
                                        <tr><td colspan="2" class="text-muted text-center">Результатів не знайдено</td></tr>
                                    }
                                    else
                                    {
                                        foreach (var user in Model.Users)
                                        {
                                            <tr>
                                                <td>@user.Id</td>
                                                <td>@user.UserName</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                            break;

                        default:
                            <p class="text-muted">Невідомий запит.</p>
                            break;
                    }
                </div>
            </div>
        }

        <div class="text-end">
            <a asp-action="Index" class="btn btn-secondary"><i class="fas fa-arrow-left me-1"></i>Повернутись до меню запитів</a>
        </div>
    </div>
</section>

<style>
    .gray-bg {
        background-color: #f8f9fa;
    }

    .section-title {
        color: #800020;
        font-weight: bold;
    }

    .card {
        border-radius: 10px;
        border: none;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .card-title {
        color: #333;
        font-weight: 500;
    }

    .highlight-card {
        border-left: 5px solid #005555;
        background-color: #e6f0fa;
    }

    .table-header {
        font-weight: bold;
    }

    .bg-maroon {
        background-color: #800020;
    }

    .bg-blue {
        background-color: #005555;
    }

    .table {
        margin-bottom: 0;
    }

        .table th, .table td {
            vertical-align: middle;
        }

    .text-maroon {
        color: #800020;
    }

        .text-maroon:hover {
            color: #660018;
            text-decoration: underline;
        }

    .highlight-card .text-maroon {
        color: #005555;
    }

        .highlight-card .text-maroon:hover {
            color: #003737;
        }

    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }

        .btn-secondary:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }

    .text-muted {
        font-size: 1.1rem;
    }
</style>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>
}